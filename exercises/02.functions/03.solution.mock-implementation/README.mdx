# Mock implementation

<EpicVideo url="https://www.epicweb.dev/workshops/mocking-techniques-in-vitest/functions/mock-implementation/solution" />

Let's start by going to the first test case for our `OrderController` and spying on the `isItemInStock` method of the created `controller` instance:

<CodeFile file="order-controller.test.ts" range="3-6" highlight="6" />

<callout-info>Since the object I'm spying on (`controller`) is scoped to this particular test, there's no need to introduce any test setup to reset the mock.</callout-info>

By using [`.mockReturnValue()`](https://vitest.dev/api/mock.html#mockreturnvalue), I am forcing the `.isItemInStock()` method to always return true when run in this test. With that behavior fixed, I can write the assertions around how the new order should be created:

<CodeFile file="order-controller.test.ts" range="3-26" highlight="17-25" />

> I prefer keeping my assertions explicit so I _repeat_ the entire `cart` object within my `expect()` statement.

In the next test case, I'd like to do things a little differently. I will still spy on the `.isItemInStock()` method, but instead of mocking its return value, I will _mock that method's implementation_.

<CodeFile file="order-controller.test.ts" range="28-33" highlight="31-33" />

By mocking the implementation, I am creating a mock with conditional behavior. It will behave differently based on the cart `item` that's being checked. Only the item with `id` that equals `4` will be considered in stock. This way, I am able to reproduce the error throwing logic as well as assert on the `controller` class including the right item IDs in the error message.

<CodeFile file="order-controller.test.ts" range="28-56" highlight="53-55" />

## Alternative approach

Because we are mocking the `.isItemInStock()` method entirely in this test, we focus our the logic of the `.createOrder()` method of the `OrderController` class. That is where we are establishing the test boundary.

Alternatively, we could also mock the dependency on `stock.json` to decide which items are in stock on the data level. Notice how that would've yielded a different test that would also include the functionality of the `.isItemInStock()` method (the filtering). You will learn more about module mocking later in this workshop.
